<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Manager v8.5.0</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import { Octokit } from "https://esm.sh/@octokit/core";
        window.Octokit = Octokit;
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { slate: { 850: '#15202e', 900: '#0f172a' }, darkbg: '#0B1120' },
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 20px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #475569; }
        [v-cloak] { display: none !important; }
        .json-tree { font-family: 'JetBrains Mono', monospace; font-size: 13px; line-height: 1.6; }
        .json-tree details { margin-left: 15px; }
        .json-tree summary { cursor: pointer; list-style: none; outline: none; display: flex; align-items: center; }
        .json-tree summary::-webkit-details-marker { display: none; }
        .json-tree summary:hover { background-color: rgba(0,0,0,0.05); border-radius: 4px; }
        .dark .json-tree summary:hover { background-color: rgba(255,255,255,0.05); }
        .json-arrow { display: inline-flex; justify-content: center; align-items: center; width: 14px; height: 14px; margin-right: 4px; font-size: 8px; color: #64748b; transition: transform 0.2s; }
        details[open] > summary > .json-arrow { transform: rotate(90deg); }
        .j-key { color: #0369a1; font-weight: 600; } .j-str { color: #15803d; } .j-num { color: #7e22ce; } .j-bool { color: #b91c1c; } .j-null { color: #64748b; font-style: italic;} .j-meta { color: #475569; } .j-dup { color: #d97706 !important; font-weight: bold; background: rgba(217, 119, 6, 0.1); padding: 0 4px; border-radius: 4px; }
        .dark .j-key { color: #60a5fa; } .dark .j-str { color: #34d399; } .dark .j-num { color: #c084fc; } .dark .j-bool { color: #f87171; } .dark .j-null { color: #94a3b8; } .dark .j-meta { color: #64748b; } .dark .j-dup { color: #fbbf24 !important; background: rgba(251, 191, 36, 0.1); }
        .dark ::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; opacity: 0.6; }
        .dark ::-webkit-calendar-picker-indicator:hover { opacity: 1; }
        .toast-enter-active, .toast-leave-active { transition: all 0.3s ease; } .toast-enter-from, .toast-leave-to { opacity: 0; transform: translateY(20px); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease; } .fade-enter-from, .fade-leave-to { opacity: 0; }
        .tab-active { border-bottom: 2px solid #6366f1; color: #6366f1; font-weight: 700; background: rgba(99, 102, 241, 0.05); }
        .dark .tab-active { border-bottom: 2px solid #818cf8; color: #818cf8; background: rgba(129, 140, 248, 0.1); }
        /* Badge for Binary Decoded Content */
        .binary-badge { font-size: 10px; background: #8b5cf6; color: white; padding: 2px 6px; border-radius: 4px; margin-left: 6px; font-weight: bold; text-transform: uppercase; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-darkbg text-slate-800 dark:text-slate-200 h-screen overflow-hidden flex flex-col transition-colors duration-300">

<div id="app" class="h-full flex flex-col" v-cloak>

    <transition name="fade">
        <div v-if="modal.show" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
            <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden transform transition-all">
                <div class="p-6 pb-2">
                    <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-1 flex items-center gap-2">
                        <span class="text-xl">
                            {{ modal.type === 'BLOCK' ? '‚õî Block Threat' : 
                               (modal.type === 'DELETE_ALL' ? '‚ö†Ô∏è Clear Entire List' : '‚ôªÔ∏è Manage Item') 
                            }}
                        </span>
                    </h3>
                    <p class="text-xs text-slate-500 font-mono break-all bg-slate-100 dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700">
                        {{ modal.val }}
                    </p>
                </div>
                <div class="px-6 py-2 space-y-4">
                    <div v-if="modal.type === 'RESTORE'">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Action</label>
                        <select v-model="modal.targetKey" class="w-full bg-slate-100 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg p-2 text-sm outline-none focus:border-indigo-500 text-slate-800 dark:text-slate-200">
                            <option value="">üö´ Just Unblock (Delete)</option>
                            <option value="GOOD_IPS">üåç Restore to Allowed IPs</option>
                            <option value="GOOD_REFERERS">üîó Restore to Referers</option>
                            <option value="SEARCH_BOTS">ü§ñ Restore to Search Bots</option>
                            <option value="AI_BOTS">üß† Restore to AI Agents</option>
                        </select>
                    </div>
                    <div v-if="modal.type !== 'DELETE_ALL'">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Reason / Note (Optional)</label>
                        <textarea v-model="modal.reason" class="w-full bg-slate-100 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg p-3 text-sm focus:border-indigo-500 outline-none text-slate-800 dark:text-slate-200 placeholder-slate-400" rows="3" placeholder="Optional note..."></textarea>
                    </div>
                    <div v-else class="text-xs text-red-500 font-bold bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-200 dark:border-red-800">
                        Warning: This action will permanently remove ALL items from this list. This cannot be undone after committing.
                    </div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-950/50 p-4 flex gap-3 justify-end border-t border-slate-200 dark:border-slate-800 mt-2">
                    <button @click="closeModal" class="px-4 py-2 text-xs font-bold text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors">Cancel</button>
                    <button @click="confirmAction" class="px-4 py-2 text-white text-xs font-bold rounded-lg transition-colors shadow-lg" :class="modal.type === 'BLOCK' || modal.type === 'DELETE_ALL' ? 'bg-red-600 hover:bg-red-700 shadow-red-500/20' : 'bg-emerald-600 hover:bg-emerald-700 shadow-emerald-500/20'">Confirm</button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="toast">
        <div v-if="toast.show" class="fixed bottom-6 right-6 z-50 px-6 py-4 rounded-xl shadow-2xl flex items-center gap-4 border border-slate-200 dark:border-white/10 backdrop-blur-md" :class="toast.isError ? 'bg-red-100 text-red-800 dark:bg-red-900/90 dark:text-red-100' : 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/90 dark:text-emerald-100'">
            <div class="text-2xl">{{ toast.isError ? '‚ùå' : '‚úÖ' }}</div>
            <div><h4 class="font-bold text-sm">{{ toast.title }}</h4><p class="text-xs opacity-90">{{ toast.message }}</p></div>
        </div>
    </transition>

    <div v-if="!token || isInitializing" class="flex-grow flex items-center justify-center relative">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 left-1/4 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl opacity-30"></div>
            <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl opacity-30"></div>
        </div>
        <div v-if="isInitializing" class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 z-10"></div>
        <div v-else class="bg-white/80 dark:bg-white/10 backdrop-blur-md p-10 rounded-3xl shadow-2xl border border-white/20 dark:border-white/10 max-w-sm w-full text-center z-10">
            <div class="w-14 h-14 mx-auto mb-6 rounded-full bg-indigo-600 flex items-center justify-center text-2xl shadow-lg text-white">üõ°Ô∏è</div>
            <h2 class="text-lg font-bold mb-6 text-slate-800 dark:text-white tracking-widest uppercase text-xs">Security Manager v8.5.0</h2>
            <input type="password" v-model="tokenInput" class="w-full p-3.5 rounded-xl bg-slate-50 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-700 text-center font-mono text-sm mb-6 outline-none focus:border-indigo-500 text-slate-800 dark:text-white placeholder-slate-400 dark:placeholder-slate-500" placeholder="GitHub Token">
            <button @click="setToken" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl transition-all active:scale-95 text-xs uppercase">Connect</button>
        </div>
    </div>

    <div v-else class="flex h-full">
        <aside class="w-64 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 transition-all duration-300" :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full absolute md:relative md:translate-x-0 z-50 h-full'">
            <div class="p-6 flex items-center gap-3 border-b border-slate-200 dark:border-slate-800">
                <div class="w-8 h-8 rounded bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm">üõ°Ô∏è</div>
                <div><h1 class="font-bold text-slate-800 dark:text-white text-sm">Security Hub</h1><p class="text-[10px] text-slate-400 font-bold">System v8.5.0</p></div>
            </div>
            <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-6">
                <div>
                    <button @click="loadDashboard" :class="currentView === 'dashboard' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-bold transition-colors mb-2"><span>üìä</span> Dashboard</button>
                </div>
                <div>
                    <h3 class="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Whitelist</h3>
                    <div class="space-y-1">
                        <button @click="currentView = 'whitelist-update'" :class="currentView === 'whitelist-update' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üìù</span> Update List</button>
                        <button @click="currentView = 'whitelist-readme'" :class="currentView === 'whitelist-readme' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üìñ</span> ReadMe & History</button>
                        <button @click="loadJson('whitelist')" :class="currentView === 'whitelist-json' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üì¶</span> JSON Source</button>
                        <button @click="loadLog('whitelist')" :class="currentView === 'whitelist-log' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üìú</span> Audit Logs</button>
                    </div>
                </div>
                <div>
                    <h3 class="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Universal Firewall</h3>
                    <div class="space-y-1">
                        <button @click="loadJson('universal')" :class="currentView === 'universal-json' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üåê</span> JSON Source</button>
                        <button @click="loadJson('binary')" :class="currentView === 'binary-json' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>ü§ñ</span> Binary List</button>
                        <button @click="loadLog('universal')" :class="currentView === 'universal-log' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üèóÔ∏è</span> Build Logs</button>
                    </div>
                </div>
                <div><h3 class="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Live Blacklist</h3><div class="space-y-1"><button @click="loadJson('livelist')" :class="currentView === 'livelist-json' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üì¶</span> JSON Source</button><button @click="loadLog('livelist')" :class="currentView === 'livelist-log' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>‚ö°</span> Live Logs</button></div></div>
                <div><h3 class="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">Global Blacklist</h3><div class="space-y-1"><button @click="loadJson('blacklist')" :class="currentView === 'blacklist-json' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üì¶</span> JSON Source</button><button @click="loadLog('blacklist')" :class="currentView === 'blacklist-log' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>‚õî</span> Block Logs</button></div></div>
                <div><h3 class="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2">System</h3><div class="space-y-1"><button @click="loadLog('system')" :class="currentView === 'system-log' ? 'bg-indigo-50 dark:bg-indigo-600/10 text-indigo-600 dark:text-indigo-400' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50'" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-xs font-medium transition-colors"><span>üñ•Ô∏è</span> System Reports</button></div></div>
            </nav>
            <div class="p-4 border-t border-slate-200 dark:border-slate-800">
                <button @click="logout" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-slate-100 hover:bg-red-50 hover:text-red-500 dark:bg-slate-800 dark:hover:bg-red-900/20 dark:hover:text-red-400 text-slate-500 dark:text-slate-400 text-xs font-bold rounded-lg transition-colors">Disconnect</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-slate-50 dark:bg-[#0B1120] relative transition-colors duration-300">
            <header class="h-14 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/50 backdrop-blur flex items-center justify-between px-6 shrink-0 transition-colors duration-300">
                <button @click="sidebarOpen = !sidebarOpen" class="md:hidden text-slate-400">‚ò∞</button>
                <div class="text-sm font-bold font-mono text-indigo-500 dark:text-indigo-400">{{ targetRepo }}</div>
                <div class="flex items-center gap-4">
                    <div class="text-xs font-bold font-mono text-slate-500" :class="{'text-red-400 animate-pulse': timeLeft < 60}">‚è±Ô∏è {{ formattedTime }}</div>
                    <button @click="toggleTheme" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-500 dark:text-slate-400"><span v-if="isDark" class="text-lg">‚òÄÔ∏è</span><span v-else class="text-lg">üåô</span></button>
                    <button v-if="currentView === 'whitelist-update'" @click="saveChanges" :disabled="loading || isPolling" class="flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs font-bold text-white shadow-lg transition-all active:scale-95 disabled:opacity-50" :class="hasUnsavedChanges ? 'bg-amber-500 hover:bg-amber-600' : (isPolling ? 'bg-indigo-400 cursor-wait' : 'bg-indigo-600 hover:bg-indigo-700')">
                        <span v-if="loading" class="animate-spin">‚è≥</span>
                        <span v-else-if="isPolling" class="animate-pulse">üîÑ Syncing...</span>
                        <span v-else>{{ hasUnsavedChanges ? '‚ö†Ô∏è Unsaved Changes' : 'üíæ Commit' }}</span>
                    </button>
                </div>
            </header>

            <div v-if="currentView === 'dashboard'" class="flex-1 overflow-y-auto p-6">
                <div v-if="loadingStats" class="flex flex-col items-center justify-center h-full">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mb-4"></div>
                    <p class="text-sm text-slate-500 animate-pulse">Analyzing Global Security Data...</p>
                </div>
                <div v-else class="space-y-6">
                    <h2 class="text-xl font-bold text-slate-800 dark:text-white">Security Posture Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
                        <div class="bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-200 dark:border-indigo-500/30 p-5 rounded-xl shadow-sm relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="text-6xl">üåê</span></div>
                            <h3 class="text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider mb-1">Universal Firewall</h3>
                            <div class="text-3xl font-bold text-slate-800 dark:text-white">{{ stats.universal.total.toLocaleString() }}</div>
                            <div class="mt-3 text-[10px] bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 px-2 py-0.5 rounded w-fit font-bold">Size: {{ stats.universal.size }}</div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-5 rounded-xl shadow-sm relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="text-6xl">üåç</span></div>
                            <h3 class="text-xs font-bold text-rose-500 uppercase tracking-wider mb-1">Global Blacklist</h3>
                            <div class="text-3xl font-bold text-slate-800 dark:text-white">{{ stats.global.total.toLocaleString() }}</div>
                            <div class="mt-3 text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-2 py-0.5 rounded w-fit font-bold">Size: {{ stats.global.size }}</div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-5 rounded-xl shadow-sm relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="text-6xl">‚ö°</span></div>
                            <h3 class="text-xs font-bold text-amber-500 uppercase tracking-wider mb-1">Live Blacklist</h3>
                            <div class="text-3xl font-bold text-slate-800 dark:text-white">{{ stats.live.total.toLocaleString() }}</div>
                            <div class="mt-3 text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-2 py-0.5 rounded w-fit font-bold">Size: {{ stats.live.size }}</div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-5 rounded-xl shadow-sm relative overflow-hidden group">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="text-6xl">üõ°Ô∏è</span></div>
                            <h3 class="text-xs font-bold text-emerald-500 uppercase tracking-wider mb-1">Whitelist</h3>
                            <div class="text-3xl font-bold text-slate-800 dark:text-white">{{ stats.whitelist.total.toLocaleString() }}</div>
                            <div class="mt-3 text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-2 py-0.5 rounded w-fit font-bold">Size: {{ stats.whitelist.size }}</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 font-bold text-xs text-indigo-600 dark:text-indigo-400">üåê Universal Firewall Composition</div>
                            <div class="divide-y divide-slate-100 dark:divide-slate-800">
                                <div v-for="(val, key) in stats.universal.breakdown" :key="key" class="px-4 py-2 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/50">
                                    <span class="text-[10px] font-mono text-slate-600 dark:text-slate-400">{{ key }}</span>
                                    <span class="text-[10px] font-bold text-slate-800 dark:text-white">{{ val.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 font-bold text-xs text-rose-500">üåç Global Blacklist Breakdown</div>
                            <div class="divide-y divide-slate-100 dark:divide-slate-800">
                                <div v-for="(val, key) in stats.global.breakdown" :key="key" class="px-4 py-2 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/50">
                                    <span class="text-[10px] font-mono text-slate-600 dark:text-slate-400">{{ key }}</span>
                                    <span class="text-[10px] font-bold text-slate-800 dark:text-white">{{ val.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 font-bold text-xs text-amber-500">‚ö° Live Blacklist Breakdown</div>
                            <div class="divide-y divide-slate-100 dark:divide-slate-800">
                                <div v-for="(val, key) in stats.live.breakdown" :key="key" class="px-4 py-2 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/50">
                                    <span class="text-[10px] font-mono text-slate-600 dark:text-slate-400">{{ key }}</span>
                                    <span class="text-[10px] font-bold text-slate-800 dark:text-white">{{ val.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 font-bold text-xs text-emerald-500">üõ°Ô∏è Whitelist Breakdown</div>
                            <div class="divide-y divide-slate-100 dark:divide-slate-800">
                                <div v-for="(val, key) in stats.whitelist.breakdown" :key="key" class="px-4 py-2 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800/50">
                                    <span class="text-[10px] font-mono text-slate-600 dark:text-slate-400">{{ key }}</span>
                                    <span class="text-[10px] font-bold text-slate-800 dark:text-white">{{ val.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden mt-6 flex flex-col h-[500px]">
                        <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 font-bold text-xs text-slate-600 dark:text-slate-300 flex items-center justify-between">
                            <div class="flex items-center gap-2"><span>ü§ñ Automation Health Hub</span><span class="text-[10px] font-normal text-slate-400">(Auto-Refreshing)</span></div>
                            <div v-if="isRefreshingActions" class="text-xs text-indigo-500 animate-pulse">Refreshing...</div>
                        </div>
                        <div class="flex border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 overflow-x-auto custom-scrollbar">
                            <button v-for="wf in sortedWorkflows" :key="wf.id" 
                                @click="selectWorkflow(wf.id)"
                                :class="['px-4 py-3 text-xs font-medium whitespace-nowrap transition-colors border-b-2', selectedWorkflowId === wf.id ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400 bg-indigo-50/50 dark:bg-indigo-900/20' : 'border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300']">
                                {{ wf.name }}
                            </button>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar relative p-0 bg-white dark:bg-slate-900">
                            <div v-if="!selectedWorkflowId" class="flex flex-col items-center justify-center h-full text-slate-400 text-xs italic">
                                <span class="text-2xl mb-2">üëà</span> Select a workflow tab to view details.
                            </div>
                            <div v-else-if="loadingRuns" class="flex items-center justify-center h-full">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div>
                            </div>
                            <div v-else>
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-slate-50 dark:bg-slate-950 sticky top-0 z-10">
                                        <tr>
                                            <th class="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase">Status</th>
                                            <th class="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase">Run ID</th>
                                            <th class="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase">Trigger</th>
                                            <th class="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase">Time (Cairo)</th>
                                            <th class="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase">Conclusion</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                                        <tr v-for="run in currentRuns" :key="run.id" class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                                            <td class="px-4 py-2">
                                                <span v-if="run.status === 'completed' && run.conclusion === 'success'" class="text-emerald-500 text-xs">‚úÖ Success</span>
                                                <span v-else-if="run.status === 'completed' && run.conclusion === 'failure'" class="text-red-500 text-xs">‚ùå Failed</span>
                                                <span v-else-if="run.status === 'in_progress'" class="text-amber-500 text-xs animate-pulse">‚è≥ Running</span>
                                                <span v-else class="text-slate-400 text-xs">{{ run.status }}</span>
                                            </td>
                                            <td class="px-4 py-2 text-xs font-mono text-slate-600 dark:text-slate-400">#{{ run.run_number }}</td>
                                            <td class="px-4 py-2 text-xs text-slate-600 dark:text-slate-300">{{ run.event }}</td>
                                            <td class="px-4 py-2 text-xs font-mono text-slate-500">{{ formatCairoTime(run.created_at) }}</td>
                                            <td class="px-4 py-2">
                                                <span class="text-[10px] px-1.5 py-0.5 rounded font-bold uppercase" 
                                                    :class="run.conclusion === 'success' ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400' : (run.conclusion === 'failure' ? 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' : 'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400')">
                                                    {{ run.conclusion || run.status }}
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div v-if="currentRuns.length === 0" class="p-6 text-center text-xs text-slate-400 italic">No recent runs found for this workflow.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'whitelist-update'" class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 pb-20">
                    <div v-for="(list, key) in editableLists" :key="key" class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm flex flex-col h-[600px] transition-colors duration-300">
                        <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-between items-center">
                            <h3 class="font-bold text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2">
                                {{ list.title }}
                                <span v-if="key === 'BLOCKED_THREATS'" class="text-[10px] bg-red-100 dark:bg-red-500/20 text-red-600 dark:text-red-400 px-1.5 py-0.5 rounded uppercase tracking-wider font-bold">Threats</span>
                            </h3>
                            <div class="flex items-center gap-2">
                                <button @click="openModal('DELETE_ALL', key)" class="text-[10px] bg-red-100 hover:bg-red-200 text-red-600 dark:bg-red-900/30 dark:hover:bg-red-900/50 dark:text-red-400 px-2 py-1 rounded transition-colors" title="Delete All">üóëÔ∏è Clear</button>
                                <span class="bg-slate-200 dark:bg-slate-700 text-xs px-2 py-0.5 rounded font-mono text-slate-600 dark:text-slate-300">{{ list.items.length }}</span>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                            <div v-for="(item, index) in list.items" :key="index" class="p-3 bg-slate-50 dark:bg-slate-900/30 rounded-lg border border-transparent hover:border-indigo-500/30 group transition-all">
                                <div class="flex flex-col gap-1 mb-1">
                                    <div class="flex justify-between items-start">
                                        <div class="flex flex-col">
                                            <span class="font-mono text-sm text-indigo-600 dark:text-indigo-400 font-bold break-all">{{ item.val }}</span>
                                            <span v-if="getOrigin(item.note)" class="text-[10px] bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-1.5 py-0.5 rounded w-fit mt-1 font-bold">
                                                From: {{ getOrigin(item.note) }}
                                            </span>
                                        </div>
                                        <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button v-if="key !== 'BLOCKED_THREATS'" @click="openModal('BLOCK', key, index, item)" class="text-slate-400 hover:text-red-500 px-1" title="Block">‚õî</button>
                                            <button v-if="key === 'BLOCKED_THREATS'" @click="openModal('RESTORE', key, index, item)" class="text-slate-400 hover:text-emerald-500 px-1" title="Restore">‚ôªÔ∏è</button>
                                            <button @click="openModal('DELETE', key, index, item)" class="text-slate-400 hover:text-red-500 px-1" title="Delete">‚úï</button>
                                        </div>
                                    </div>
                                </div>
                                <textarea v-model="item.note" @input="markDirty" class="w-full bg-transparent text-xs text-slate-600 dark:text-slate-300 focus:text-slate-900 dark:focus:text-white border-none p-0 outline-none resize-none placeholder-slate-400" rows="1" placeholder="Add note..."></textarea>
                            </div>
                        </div>
                        <div class="p-3 bg-slate-100 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700">
                            <div class="flex gap-2 mb-2"><input v-model="inputs[key].val" @keyup.enter="addItem(key)" class="flex-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded px-3 py-2 text-xs font-mono outline-none focus:border-indigo-500 text-slate-800 dark:text-white" :placeholder="list.placeholder"></div>
                            <div class="flex gap-2"><input v-model="inputs[key].note" @keyup.enter="addItem(key)" class="flex-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded px-3 py-2 text-xs outline-none focus:border-indigo-500 text-slate-800 dark:text-white" placeholder="Optional Note..."><button @click="addItem(key)" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded px-3 py-2 text-xs font-bold">Add</button></div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'whitelist-readme'" class="flex-1 overflow-hidden p-6 relative">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                    <div class="flex flex-col bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm h-full">
                        <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                            <h2 class="text-sm font-bold text-slate-700 dark:text-white">üõ°Ô∏è Security Whitelist Documentation</h2>
                            <p class="text-[10px] text-slate-500 mt-1">Last Updated: {{ new Date().toUTCString() }}</p>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6">
                            <div v-for="(list, key) in editableLists" :key="key">
                                <h3 class="font-bold text-sm text-slate-800 dark:text-slate-200 mb-2 border-b border-slate-200 dark:border-slate-700 pb-1">{{ list.title }}</h3>
                                <div v-if="list.items.length === 0" class="text-xs text-slate-400 italic">No records.</div>
                                <ul v-else class="space-y-1">
                                    <li v-for="item in list.items" class="text-xs text-slate-600 dark:text-slate-400 font-mono flex items-center gap-2">
                                        <span class="text-slate-400">‚Ä¢</span>
                                        <span class="bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded">{{ item.val }}</span>
                                        <span v-if="item.note" class="text-[11px] text-slate-400 dark:text-slate-300 italic">üìù {{ item.note }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden shadow-sm h-full">
                        <div class="p-4 border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex flex-col gap-3">
                            <div class="flex justify-between items-center">
                                <h2 class="text-sm font-bold text-slate-700 dark:text-white">üìú Threat History (Permanent Log)</h2>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" v-model="historyUniqueOnly" class="accent-indigo-600 rounded">
                                    <span class="text-xs text-slate-500">Show Unique Only</span>
                                </label>
                            </div>
                            <div class="flex gap-2 items-center">
                                <input v-model="historySearchQuery" placeholder="Search..." class="flex-1 bg-white dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-1.5 text-xs focus:border-indigo-500 outline-none text-slate-800 dark:text-white">
                                <input type="date" v-model="historyStartDate" class="bg-white dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-800 dark:text-white">
                                <span class="text-slate-400 text-xs">-</span>
                                <input type="date" v-model="historyEndDate" class="bg-white dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-800 dark:text-white">
                                <button v-if="historyStartDate || historyEndDate" @click="historyStartDate='';historyEndDate=''" class="text-slate-400 hover:text-red-500 px-1" title="Clear Dates">‚úï</button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1">
                            <div v-if="filteredHistory.length === 0" class="text-center text-slate-400 text-xs italic mt-10">No history records found.</div>
                            <div v-for="(h, i) in filteredHistory" :key="i" class="p-2 rounded border border-slate-100 dark:border-slate-800/50 bg-slate-50/50 dark:bg-slate-950/30 hover:bg-slate-100 dark:hover:bg-slate-900 transition-colors flex flex-col gap-0.5">
                                <div class="flex justify-between items-baseline gap-2">
                                    <div class="flex items-center gap-2 min-w-0">
                                        <span class="text-[9px] font-bold px-1.5 py-0.5 rounded uppercase shrink-0" :class="(h.action.includes('ADDED') || h.action.includes('BLOCKED')) ? 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400' : 'bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400'">{{ h.action }}</span>
                                        <code class="text-xs font-mono text-slate-800 dark:text-slate-200 font-bold truncate">{{ h.val }}</code>
                                    </div>
                                    <span class="text-[9px] font-mono text-slate-400 dark:text-slate-300 shrink-0">{{ h.date }}</span>
                                </div>
                                <div v-if="h.note" class="text-[10px] text-slate-500 dark:text-slate-300 italic pl-1 truncate">‚Ü≥ {{ h.note }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div v-if="currentView.includes('-json')" class="flex-1 overflow-hidden flex flex-col bg-slate-50 dark:bg-slate-950 relative transition-colors duration-300">
                <div v-if="loadingLog" class="absolute inset-0 flex items-center justify-center bg-slate-50 dark:bg-slate-950 z-20"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div></div>
                <div class="p-3 border-b border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-between items-center sticky top-0 z-10" v-if="activeLogContent && !activeLogContent.startsWith('Error')">
                    <div class="text-xs font-mono text-slate-500 font-bold flex items-center gap-2">
                        JSON Explorer
                        <span v-if="jsonRecordCount > 0" class="bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400 px-2 py-0.5 rounded text-[10px]">{{ jsonRecordCount.toLocaleString() }} Records</span>
                        <span v-if="currentFileSize" class="bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-400 px-2 py-0.5 rounded text-[10px]">üíæ {{ currentFileSize }}</span>
                    </div>
                    <div class="flex gap-2 items-center">
                        <button @click="showRawJson = !showRawJson" class="px-2 py-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 rounded text-[10px] hover:bg-slate-200 dark:hover:bg-slate-700">{{ showRawJson ? 'Show Tree' : 'Show Raw' }}</button>
                        <button @click="expandAll" class="px-2 py-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 rounded text-[10px] hover:bg-slate-200 dark:hover:bg-slate-700" v-if="!showRawJson">Expand All</button>
                        <button @click="collapseAll" class="px-2 py-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 rounded text-[10px] hover:bg-slate-200 dark:hover:bg-slate-700" v-if="!showRawJson">Collapse All</button>
                        <div class="relative group" v-if="!showRawJson">
                            <input v-model="jsonSearchQuery" placeholder="Filter JSON..." class="bg-slate-100 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-1.5 pr-8 text-xs outline-none focus:border-indigo-500 text-slate-800 dark:text-white w-64 transition-all">
                            <button v-if="jsonSearchQuery" @click="jsonSearchQuery = ''" class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">‚úï</button>
                        </div>
                    </div>
                </div>

                <div v-if="!activeLogContent || activeLogContent.trim() === ''" class="flex-1 flex flex-col items-center justify-center text-slate-500"><div class="text-4xl mb-4 grayscale opacity-50">üìÇ</div><h3 class="font-bold text-sm mb-1">File Empty or Missing</h3></div>
                
                <div v-else class="flex-1 flex overflow-hidden">
                    <div class="flex-1 overflow-y-auto p-6 custom-scrollbar bg-slate-50 dark:bg-[#0d1117] border-r border-slate-200 dark:border-slate-800" ref="jsonContainer">
                        <pre v-if="showRawJson" class="font-mono text-xs text-slate-800 dark:text-emerald-400 whitespace-pre-wrap">{{ activeLogContent }}</pre>
                        <div v-else class="json-tree" v-html="renderJsonTree(filteredJsonObj)"></div>
                    </div>
                    <div class="w-72 bg-slate-50 dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800 flex flex-col" v-if="!showRawJson">
                        <div class="p-3 border-b border-slate-200 dark:border-slate-800 bg-slate-100 dark:bg-slate-950 font-bold text-xs text-slate-500 uppercase tracking-wider flex items-center gap-2">
                            <span>‚ö†Ô∏è Duplicate Inspector</span>
                            <button v-if="jsonSearchQuery && sortedDuplicates.some(x => x[0] === jsonSearchQuery)" @click="jsonSearchQuery = ''" class="ml-2 text-[10px] bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-2 py-0.5 rounded transition-colors">Clear Selection</button>
                            <span class="ml-auto bg-slate-200 dark:bg-slate-800 px-1.5 py-0.5 rounded text-[10px] text-slate-600 dark:text-slate-400">{{ sortedDuplicates.length }}</span>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar p-0">
                            <div v-if="sortedDuplicates.length === 0" class="flex flex-col items-center justify-center h-40 text-slate-400 text-xs italic">
                                <span class="text-xl mb-1">‚úÖ</span>
                                <span>No duplicates found.</span>
                            </div>
                            <div v-else class="divide-y divide-slate-200 dark:divide-slate-800">
                                <div v-for="[val, count] in sortedDuplicates" :key="val" class="p-3 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors flex justify-between items-center group cursor-pointer" @click="jsonSearchQuery = val">
                                    <code class="text-xs font-mono text-slate-700 dark:text-slate-300 break-all">{{ val }}</code>
                                    <span class="text-[10px] font-bold bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-0.5 rounded-full">x{{ count }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView.includes('-log')" class="flex-1 overflow-y-auto p-4 custom-scrollbar bg-white dark:bg-slate-950"><div v-if="loadingLog" class="flex justify-center mt-10"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div></div><pre v-else class="font-mono text-xs whitespace-pre-wrap" v-html="formattedLogContent"></pre></div>
        </main>
    </div>
</div>

<script type="module">
    import { Octokit } from "https://esm.sh/@octokit/core";
    const { createApp } = Vue;

    const TARGET_OWNER = 'malaareda'; 
    const TARGET_REPO  = 'security-list';         
    const FILE_TEMP    = 'security-list-backup/security-whitelist-backup/security-whitelist-temp.json';
    const FILE_README  = 'security-list-backup/security-whitelist-backup/README.md';
    
    const JSON_FILES = { 
        'whitelist': 'security-list-backup/security-whitelist-backup/security-whitelist-R.00.json', 
        'blacklist': 'security-list-backup/security-blacklist-backup/security-blacklist-R.00.json', 
        'livelist':  'security-list-backup/security-live-blacklist-backup/security-live-blacklist-R.00.json',
        'universal': 'security-list-backup/security-universal-list-backup/security-Universal-list-R.00.json',
        'binary':    'security-list-backup/security-universal-list-backup/security-universal-list-binary.json' // New Binary Map
    };
    
    const LOGS = { 
        'whitelist': 'security-list-backup/security-whitelist-backup/whitelist-security-audit.log', 
        'blacklist': 'security-list-backup/security-blacklist-backup/blacklist-security-audit.log', 
        'livelist':  'security-list-backup/security-live-blacklist-backup/live-blacklist-security-audit.log', 
        'universal': 'security-list-backup/security-universal-list-backup/universal-gen.log',
        'system': 'security-list-backup/system-reports.log' 
    };
    
    const STATUS_CONFIG = { SUCCESS:{label:'SUCCESS',hex:'#16a34a'}, INFO:{label:'INFO',hex:'#2563eb'}, WARN:{label:'WARNING',hex:'#d97706'}, ERROR:{label:'ERROR',hex:'#dc2626'}, PROCESS:{label:'PROCESS',hex:'#0891b2'}, START:{label:'START',hex:'#9333ea'}, CLEANUP:{label:'CLEANUP',hex:'#4b5563'} };
    const INACTIVITY_MINUTES = 10; 

    createApp({
        data() {
            return {
                isInitializing: true, token: localStorage.getItem('gh_token') || '', tokenInput: '', loading: false, loadingLog: false, loadingStats: false, sidebarOpen: false, targetRepo: `${TARGET_OWNER}/${TARGET_REPO}`, isDark: true, currentView: 'whitelist-update', targetTime: 0, timeLeft: INACTIVITY_MINUTES * 60, countdownInterval: null, hasUnsavedChanges: false, activeLogContent: '', currentFileSize: '',
                toast: { show: false, title: '', message: '', isError: false },
                modal: { show: false, type: '', sourceKey: '', index: null, val: '', reason: '', targetKey: '' },
                sessionHistory: [], existingReadmeContent: '', historySearchQuery: '', historyStartDate: '', historyEndDate: '', historyUniqueOnly: false,
                jsonSearchQuery: '', parsedActiveJson: null, showRawJson: false, duplicateMap: new Map(), isPolling: false, pollInterval: null, currentGeneratedAt: null,
                editableLists: { GOOD_IPS:{title:'üåç Allowed IPs',placeholder:'IP Address...',items:[]}, BLOCKED_THREATS:{title:'‚õî Blocked Threats',placeholder:'IP / UA / Domain...',items:[]}, GOOD_REFERERS:{title:'üîó Referers',placeholder:'Domain...',items:[]}, SEARCH_BOTS:{title:'ü§ñ Search Bots',placeholder:'User-Agent...',items:[]}, AI_BOTS:{title:'üß† AI Agents',placeholder:'User-Agent...',items:[]} },
                inputs: { GOOD_IPS:{val:'',note:''}, BLOCKED_THREATS:{val:'',note:''}, GOOD_REFERERS:{val:'',note:''}, SEARCH_BOTS:{val:'',note:''}, AI_BOTS:{val:'',note:''} },
                stats: { 
                    global: { total: 0, size: '0 KB', breakdown: {} },
                    live: { total: 0, size: '0 KB', breakdown: {} },
                    whitelist: { total: 0, size: '0 KB', breakdown: {} },
                    universal: { total: 0, size: '0 KB', breakdown: {} },
                    totalSize: '0 KB', lastUpdate: '-'
                },
                workflows: [], runsByWorkflow: {}, selectedWorkflowId: null, loadingRuns: false, isRefreshingActions: false, actionPollInterval: null
            }
        },
        computed: {
            formattedTime() { const m=Math.floor(Math.max(0,this.timeLeft)/60).toString().padStart(2,'0'); const s=(Math.max(0,this.timeLeft)%60).toString().padStart(2,'0'); return `${m}:${s}`; },
            renderedReadme() { return marked.parse(this.generateReadmeContent(true)); },
            totalItems() { let c=0; for(const k in this.editableLists) c+=this.editableLists[k].items.length; return c; },
            sortedDuplicates() {
                if (!this.duplicateMap.size) return [];
                return Array.from(this.duplicateMap.entries()).filter(x => x[1] > 1).sort((a, b) => b[1] - a[1]); 
            },
            jsonRecordCount() {
                if (!this.duplicateMap.size) return 0;
                let total = 0;
                for (let count of this.duplicateMap.values()) total += count;
                return total;
            },
            parsedHistory() {
                const h = [];
                this.sessionHistory.forEach(i => h.push(i));
                if (this.existingReadmeContent.includes('## üìú')) {
                    const lines = this.existingReadmeContent.split('## üìú')[1].split('\n');
                    lines.forEach(l => {
                        const m = l.match(/- (.*?) \[(.*?)\] \*\*(.*?)\*\*: \`(.*?)\` \| Reason: \*(.*?)\*/);
                        if (m) h.push({ date: m[2], action: m[3], val: m[4], note: m[5] });
                    });
                }
                return h.sort((a, b) => new Date(b.date) - new Date(a.date));
            },
            filteredHistory() {
                let res = this.parsedHistory;
                const q = this.historySearchQuery.toLowerCase();
                if (q) res = res.filter(i => i.val.toLowerCase().includes(q) || i.note.toLowerCase().includes(q) || i.action.toLowerCase().includes(q));
                if (this.historyStartDate) res = res.filter(i => new Date(i.date) >= new Date(this.historyStartDate));
                if (this.historyEndDate) res = res.filter(i => new Date(i.date) <= new Date(this.historyEndDate));
                if (this.historyUniqueOnly) {
                    const uniqueMap = new Map();
                    res.forEach(item => { if (!uniqueMap.has(item.val)) uniqueMap.set(item.val, item); });
                    res = Array.from(uniqueMap.values());
                }
                return res;
            },
            filteredJsonObj() { if(!this.parsedActiveJson)return null; if(!this.jsonSearchQuery)return this.parsedActiveJson; return this.filterObject(this.parsedActiveJson, this.jsonSearchQuery.toLowerCase()); },
            formattedLogContent() { 
                if(!this.activeLogContent)return ''; 
                const rawLines = this.activeLogContent.split('\n');
                const reversed = [...rawLines].reverse();
                return reversed.map(l=>{ 
                    if(l.startsWith('=')||l.startsWith('-')||l.includes('[SESSION')) return `<span class="text-slate-900 dark:text-yellow-400 font-bold">${l}</span>`; 
                    for(const k in STATUS_CONFIG)if(l.includes(STATUS_CONFIG[k].label))return `<span style="color:${STATUS_CONFIG[k].hex};font-weight:600">${l}</span>`; 
                    return `<span class="text-slate-600 dark:text-slate-400">${l}</span>`; 
                }).join('\n'); 
            },
            sortedWorkflows() { return this.workflows.sort((a, b) => a.name.localeCompare(b.name)); },
            currentRuns() { if (!this.selectedWorkflowId) return []; return this.runsByWorkflow[this.selectedWorkflowId] || []; }
        },
        mounted() { this.initTheme(); if(this.token){this.loadWhitelistData();this.startCountdown();}else{this.isInitializing=false;} ['mousemove','keydown','click'].forEach(e=>window.addEventListener(e,this.resetActivity)); },
        methods: {
            initTheme() { const t=localStorage.getItem('theme'); this.isDark=t?t==='dark':true; this.applyTheme(); },
            toggleTheme() { this.isDark=!this.isDark; localStorage.setItem('theme',this.isDark?'dark':'light'); this.applyTheme(); },
            applyTheme() { if(this.isDark)document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); },
            showToast(t,m,e=false) { if(this.isInitializing)return; this.toast={show:true,title:t,message:m,isError:e}; setTimeout(()=>{this.toast.show=false},4000); },
            setToken() { if(!this.tokenInput.trim())return; this.token=this.tokenInput; localStorage.setItem('gh_token',this.token); this.loadWhitelistData(); this.startCountdown(); },
            logout() { this.token=''; this.tokenInput=''; localStorage.removeItem('gh_token'); clearInterval(this.countdownInterval); if(this.actionPollInterval) clearInterval(this.actionPollInterval); this.isInitializing=false; },
            startCountdown() { this.resetActivity(); if(this.countdownInterval)clearInterval(this.countdownInterval); this.countdownInterval=setInterval(()=>{ const n=Date.now(); this.timeLeft=Math.ceil((this.targetTime-n)/1000); if(this.timeLeft<=0)this.logout(); },1000); },
            resetActivity() { if(!this.token)return; this.targetTime=Date.now()+(INACTIVITY_MINUTES*60*1000); },
            markDirty() { this.hasUnsavedChanges=true; this.resetActivity(); },

            async loadWhitelistData() {
                this.loading=true; const octokit=new Octokit({auth:this.token});
                try {
                    const r1=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['whitelist']}?t=${Date.now()}`);
                    const json=JSON.parse(decodeURIComponent(escape(atob(r1.data.content))));
                    if(json.meta && json.meta.generatedAt) this.currentGeneratedAt = json.meta.generatedAt;
                    try{const r2=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${FILE_README}`); this.existingReadmeContent=decodeURIComponent(escape(atob(r2.data.content)));}catch(e){this.existingReadmeContent='';}
                    this.mergeData(json,this.existingReadmeContent);
                    this.isInitializing=false; this.hasUnsavedChanges=false;
                } catch(e) { if(e.status===404){this.isInitializing=false;this.hasUnsavedChanges=false;}else{if(!this.isInitializing)this.showToast('Login Failed',e.message,true);this.logout();} } finally { this.loading=false; }
            },
            mergeData(json, readme) {
                const map={}; readme.split('\n').forEach(l=>{const m=l.match(/- `(.*?)` \| üìù (.*)/); if(m)map[m[1]]=m[2];});
                const pop=(k,arr)=>{ this.editableLists[k].items=(arr||[]).map(v=>({val:v,note:map[v]||''})); };
                pop('GOOD_IPS',json.GOOD_IPS); pop('BLOCKED_THREATS',json.BLOCKED_THREATS||json.BLOCKED_IPS); pop('GOOD_REFERERS',json.GOOD_REFERERS); pop('SEARCH_BOTS',json.GOOD_BOTS?.SEARCH_BOTS); pop('AI_BOTS',json.GOOD_BOTS?.AI_BOTS);
            },
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 KB';
                const k = 1024;
                const kbVal = bytes / k;
                if (kbVal < 1000) return kbVal.toFixed(2) + ' KB';
                return (kbVal / 1024).toFixed(2) + ' MB';
            },

            formatCairoTime(isoString) {
                if (!isoString) return '-';
                try {
                    return new Date(isoString).toLocaleString('en-GB', {
                        timeZone: 'Africa/Cairo',
                        day: '2-digit', month: '2-digit', year: 'numeric',
                        hour: '2-digit', minute: '2-digit', second: '2-digit',
                        hour12: true
                    }) + ' (Cairo)';
                } catch(e) { return isoString; }
            },

            async fetchAllWorkflows() {
                const octokit = new Octokit({ auth: this.token });
                try {
                    const res = await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/actions/workflows`);
                    this.workflows = res.data.workflows.filter(w => w.state === 'active');
                    if (!this.selectedWorkflowId && this.workflows.length > 0) this.selectedWorkflowId = this.workflows[0].id;
                    await Promise.all(this.workflows.map(w => this.fetchWorkflowRuns(w.id)));
                } catch (e) { console.warn("Workflow fetch failed", e); }
            },

            async fetchWorkflowRuns(workflowId) {
                const octokit = new Octokit({ auth: this.token });
                try {
                    const res = await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/actions/workflows/${workflowId}/runs`, {
                        per_page: 20
                    });
                    this.runsByWorkflow[workflowId] = res.data.workflow_runs;
                } catch(e) { console.warn("Run fetch failed", e); }
            },

            selectWorkflow(id) {
                this.selectedWorkflowId = id;
                this.loadingRuns = true;
                this.fetchWorkflowRuns(id).finally(() => this.loadingRuns = false);
            },

            async loadDashboard() {
                this.currentView = 'dashboard';
                this.loadingStats = true;
                const octokit = new Octokit({ auth: this.token });
                let totalBytes = 0;
                
                try {
                    await this.fetchAllWorkflows();

                    // Fetch 4 Files
                    const [resWhite, resBlack, resLive, resUniv] = await Promise.all([
                        octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['whitelist']}`),
                        octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['blacklist']}`),
                        octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['livelist']}`),
                        octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['universal']}`)
                    ]);
                    
                    const process = (res) => {
                        const raw = atob(res.data.content);
                        const size = raw.length;
                        totalBytes += size;
                        return { data: JSON.parse(decodeURIComponent(escape(raw))), size };
                    };

                    const w = process(resWhite);
                    const b = process(resBlack);
                    const l = process(resLive);
                    const u = process(resUniv);

                    // =========================================================================================
                    // NEW DYNAMIC STATS LOGIC (Scans for Underscores)
                    // =========================================================================================
                    const calculateStats = (data) => {
                        let total = 0;
                        const breakdown = {};
                        
                        const scan = (obj, parentKey='') => {
                            if (typeof obj === 'object' && obj !== null) {
                                if (Array.isArray(obj)) {
                                    if (parentKey && parentKey.includes('_')) {
                                        total += obj.length;
                                        breakdown[parentKey] = obj.length;
                                    }
                                } else {
                                    Object.keys(obj).forEach(k => scan(obj[k], k));
                                }
                            }
                        };
                        scan(data);
                        return { total, breakdown };
                    };

                    const sW = calculateStats(w.data);
                    const sB = calculateStats(b.data);
                    const sL = calculateStats(l.data);
                    const sU = calculateStats(u.data);

                    this.stats.whitelist = { total: sW.total, size: this.formatFileSize(w.size), breakdown: sW.breakdown };
                    this.stats.global = { total: sB.total, size: this.formatFileSize(b.size), breakdown: sB.breakdown };
                    this.stats.live = { total: sL.total, size: this.formatFileSize(l.size), breakdown: sL.breakdown };
                    this.stats.universal = { total: sU.total, size: this.formatFileSize(u.size), breakdown: sU.breakdown };

                    this.stats.totalSize = this.formatFileSize(totalBytes);
                    this.stats.lastUpdate = b.data.meta?.generatedAt ? new Date(b.data.meta.generatedAt).toLocaleString() : 'Unknown';

                } catch (e) {
                    this.showToast('Stats Error', 'Failed to fetch global lists.', true);
                    console.error(e);
                } finally {
                    this.loadingStats = false;
                }
            },
            
            startPolling() {
                this.isPolling = true; this.showToast('Processing', 'Updates sent. Waiting for automation...');
                if (this.pollInterval) clearInterval(this.pollInterval);
                this.pollInterval = setInterval(async () => {
                    const octokit = new Octokit({ auth: this.token });
                    try {
                        const res = await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES['whitelist']}?t=${Date.now()}`);
                        const content = JSON.parse(decodeURIComponent(escape(atob(res.data.content))));
                        const newGenTime = content.meta?.generatedAt;
                        if (newGenTime && newGenTime !== this.currentGeneratedAt) {
                            clearInterval(this.pollInterval); this.isPolling = false; this.currentGeneratedAt = newGenTime;
                            this.loadWhitelistData(); this.showToast('Sync Complete', 'Data reloaded from GitHub.', false);
                        }
                    } catch (e) {}
                }, 2000);

                if (this.actionPollInterval) clearInterval(this.actionPollInterval);
                this.actionPollInterval = setInterval(async () => {
                    if (this.currentView === 'dashboard' && this.selectedWorkflowId) {
                        this.isRefreshingActions = true;
                        await Promise.all(this.workflows.map(w => this.fetchWorkflowRuns(w.id)));
                        this.isRefreshingActions = false;
                    }
                }, 15000);
            },
            
            async saveChanges() {
                this.loading=true; const octokit=new Octokit({auth:this.token});
                try {
                    const pl = { GOOD_IPS:this.editableLists.GOOD_IPS.items.map(i=>i.val), BLOCKED_THREATS:this.editableLists.BLOCKED_THREATS.items.map(i=>i.val), GOOD_REFERERS:this.editableLists.GOOD_REFERERS.items.map(i=>i.val), GOOD_BOTS:{ SEARCH_BOTS:this.editableLists.SEARCH_BOTS.items.map(i=>i.val), AI_BOTS:this.editableLists.AI_BOTS.items.map(i=>i.val) } };
                    const md = this.generateReadmeContent(false);
                    let sha1=null; try{const r=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${FILE_TEMP}`); sha1=r.data.sha;}catch(e){}
                    await octokit.request(`PUT /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${FILE_TEMP}`, { message:'üõ°Ô∏è Update Whitelist (WebUI)', content:btoa(unescape(encodeURIComponent(JSON.stringify(pl,null,2)))), sha:sha1 });
                    let sha2=null; try{const r=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${FILE_README}`); sha2=r.data.sha;}catch(e){}
                    await octokit.request(`PUT /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${FILE_README}`, { message:'üìù Update Docs', content:btoa(unescape(encodeURIComponent(md))), sha:sha2 });
                    this.hasUnsavedChanges=false; this.sessionHistory=[]; this.existingReadmeContent=md; this.resetActivity(); this.startPolling();
                } catch(e) { console.error(e); this.showToast('Error',e.message,true); } finally { this.loading=false; }
            },
            addItem(key) { 
                const v=this.inputs[key].val.trim(); const n=this.inputs[key].note.trim(); 
                if(!v)return; 
                this.editableLists[key].items.unshift({val:v,note:n}); 
                this.inputs[key].val='';this.inputs[key].note=''; 
                if(key==='BLOCKED_THREATS')this.sessionHistory.push({action:'ADDED',val:v,note:n,date:this.getLogTimestamp()}); 
                this.markDirty(); 
            },
            deleteItem(key,index,item) { this.openModal('DELETE', key, index, item); }, 
            openModal(t,k,i,v) { 
                let tk=''; 
                if(t==='RESTORE'){const m=v.note?v.note.match(/\[Origin: (.*?)\]/):null;if(m&&this.editableLists[m[1]])tk=m[1];} 
                this.modal={show:true,type:t,sourceKey:k,index:i,val:t==='DELETE_ALL' ? `ALL records in ${this.editableLists[k].title}` : v.val,reason:'',targetKey:tk}; 
            },
            closeModal() { this.modal.show=false; },
            confirmAction() { 
                if (this.modal.type === 'DELETE_ALL') {
                    this.editableLists[this.modal.sourceKey].items = [];
                    this.sessionHistory.push({action:'CLEARED', val:`All items in ${this.modal.sourceKey}`, note:'Bulk Delete', date:this.getLogTimestamp()});
                } else {
                    this.editableLists[this.modal.sourceKey].items.splice(this.modal.index,1); 
                    const reasonText = this.modal.reason || 'No reason provided';
                    if (this.modal.type === 'BLOCK') {
                        const n = `[Origin: ${this.modal.sourceKey}] ${reasonText}`;
                        this.editableLists.BLOCKED_THREATS.items.unshift({val:this.modal.val, note:n});
                        this.sessionHistory.push({action:'BLOCKED', val:this.modal.val, note:n, date:this.getLogTimestamp()});
                    } else if (this.modal.type === 'RESTORE') {
                        if (this.modal.targetKey) {
                            this.editableLists[this.modal.targetKey].items.unshift({val:this.modal.val, note:reasonText});
                            this.sessionHistory.push({action:'RESTORED', val:this.modal.val, note:reasonText, date:this.getLogTimestamp()});
                        } else {
                            this.sessionHistory.push({action:'UNBLOCKED', val:this.modal.val, note:reasonText, date:this.getLogTimestamp()});
                        }
                    }
                }
                this.markDirty(); this.closeModal(); 
            },
            calculateDuplicates(obj, parentKey = '') {
                if (typeof obj === 'object' && obj !== null) {
                    if (Array.isArray(obj)) { 
                        // Pass same parentKey down for array items
                        obj.forEach(i => this.calculateDuplicates(i, parentKey)); 
                    } else { 
                        // Update parentKey for object properties
                        Object.keys(obj).forEach(key => this.calculateDuplicates(obj[key], key)); 
                    }
                } else if (['string', 'number'].includes(typeof obj)) {
                    // NEW LOGIC: Only count if parentKey contains underscore '_'
                    // This filters out metadata like 'source', 'version', 'generatedAt'
                    if (parentKey && parentKey.includes('_') && typeof obj === 'string') {
                        const val = String(obj); 
                        this.duplicateMap.set(val, (this.duplicateMap.get(val) || 0) + 1);
                    }
                }
            },
            async loadJson(t) { 
                this.currentView=t+'-json'; this.activeLogContent=''; this.currentFileSize=''; this.loadingLog=true; 
                const octokit=new Octokit({auth:this.token}); 
                try {
                    const r=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${JSON_FILES[t]}`); 
                    // Calculate Size using Helper
                    const rawContent = atob(r.data.content);
                    const bytes = rawContent.length;
                    this.currentFileSize = this.formatFileSize(bytes);

                    const c=decodeURIComponent(escape(rawContent)); 
                    this.activeLogContent=c; 
                    this.parsedActiveJson=JSON.parse(c);

                    // BINARY DECODER LOGIC
                    if (t === 'binary') {
                        const decodedJson = { ...this.parsedActiveJson }; // Clone
                        
                        // Helper to convert Base64 Uint32 to Array of IPs
                        const decodeIPs = (base64) => {
                            if (!base64) return [];
                            const binaryString = atob(base64);
                            const len = binaryString.length;
                            const bytes = new Uint8Array(len);
                            for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
                            const uint32 = new Uint32Array(bytes.buffer);
                            
                            const ips = [];
                            for (let i = 0; i < uint32.length; i++) {
                                const int = uint32[i];
                                ips.push(
                                    ((int >>> 24) & 0xFF) + "." +
                                    ((int >>> 16) & 0xFF) + "." +
                                    ((int >>> 8) & 0xFF) + "." +
                                    (int & 0xFF)
                                );
                            }
                            return ips;
                        };

                        if (decodedJson.UNIVERSAL_BLACK_LIST_IPS) {
                            decodedJson.UNIVERSAL_BLACK_LIST_IPS = decodeIPs(decodedJson.UNIVERSAL_BLACK_LIST_IPS);
                        }
                        if (decodedJson.UNIVERSAL_WHITE_LIST_IPS) {
                            decodedJson.UNIVERSAL_WHITE_LIST_IPS = decodeIPs(decodedJson.UNIVERSAL_WHITE_LIST_IPS);
                        }
                        
                        this.parsedActiveJson = decodedJson; // Swap with decoded version for display
                    }

                    this.duplicateMap = new Map();
                    this.calculateDuplicates(this.parsedActiveJson);
                } catch(e) {
                    if(e.status!==404)this.activeLogContent=`Error: ${e.message}`;
                } finally {
                    this.loadingLog=false;
                } 
            },
            filterObject(obj, query) { if (!query) return obj; if (typeof obj!=='object'||obj===null) return String(obj).toLowerCase().includes(query)?obj:undefined; if(Array.isArray(obj)){const f=obj.map(i=>this.filterObject(i,query)).filter(i=>i!==undefined);return f.length?f:undefined;} const r={};let h=false;Object.keys(obj).forEach(k=>{if(k.toLowerCase().includes(query)){r[k]=obj[k];h=true;}else{const v=this.filterObject(obj[k],query);if(v!==undefined){r[k]=v;h=true;}}}); return h?r:undefined; },
            renderJsonTree(data) { 
                if(data===undefined)return '<span class="j-null">No matches.</span>'; 
                if(data===null)return '<span class="j-null">null</span>'; 
                if(['string','number','boolean'].includes(typeof data)) {
                    const valStr = String(data); const count = this.duplicateMap.get(valStr) || 0;
                    let html = '';
                    if(typeof data==='string') html = `<span class="j-str">"${data}"</span>`;
                    else if(typeof data==='number') html = `<span class="j-num">${data}</span>`;
                    else html = `<span class="j-bool">${data}</span>`;
                    
                    // NEW LOGIC: Only show duplicate warning for strings
                    if (count > 1 && typeof data === 'string') { 
                        html += ` <span class="j-dup" title="This value appears ${count} times">‚ö†Ô∏è (x${count})</span>`; 
                    }
                    return html;
                }
                const arr=Array.isArray(data); const k=Object.keys(data); 
                if(!k.length)return arr?'<span class="j-meta">[]</span>':'<span class="j-meta">{}</span>'; 
                let h=`<details open><summary><span class="json-arrow">‚ñ∂</span> <span class="j-meta">${arr?`Array(${k.length})`:`Object{${k.length}}`}</span></summary>`; 
                k.forEach(key=>{ h+=`<div>`; if(!arr)h+=`<span class="j-key">"${key}"</span>: `; h+=this.renderJsonTree(data[key]); h+=`<span class="j-meta">,</span></div>`; }); 
                h+=`</details>`; return h; 
            },
            expandAll() { this.$refs.jsonContainer.querySelectorAll('details').forEach(d=>d.open=true); }, collapseAll() { this.$refs.jsonContainer.querySelectorAll('details').forEach(d=>d.open=false); }, copyJson() { if(this.parsedActiveJson) { navigator.clipboard.writeText(JSON.stringify(this.parsedActiveJson,null,4)); this.showToast('Copied','JSON copied.'); } }, triggerJsonSearch() {}, getOrigin(note) { if(!note)return null; const m=note.match(/\[Origin: (.*?)\]/); if(m){const k=m[1];const l=this.editableLists[k];return l?l.title.replace(/^[^\s]+\s/,''):k;} return null; }, getLogTimestamp() { const n=new Date(); return `${n.toLocaleDateString('en-CA')} ${n.toLocaleTimeString('en-US',{hour12:true})}`; },
            generateReadmeContent(p=false) { let md=`# üõ°Ô∏è Security Whitelist Documentation\n\n**Last Updated:** ${new Date().toUTCString()}\n\n> Auto-generated by Security Manager WebUI.\n\n`; const s=[{key:'GOOD_IPS',t:'üåç Allowed IPs'},{key:'BLOCKED_THREATS',t:'‚õî Blocked Threats'},{key:'GOOD_REFERERS',t:'üîó Referers'},{key:'SEARCH_BOTS',t:'ü§ñ Search Bots'},{key:'AI_BOTS',t:'üß† AI Agents'}]; s.forEach(x=>{md+=`## ${x.t}\n`;const i=this.editableLists[x.key].items;if(!i.length)md+='*No records.*\n\n';else{i.forEach(j=>{md+=`- \`${j.val}\`${j.note?` | üìù ${j.note}`:''}\n`;});md+='\n';}}); const h=`## üìú Threat History (Permanent Log)`; let ht=''; if(this.existingReadmeContent.includes(h))ht=this.existingReadmeContent.split(h)[1].trim(); if(this.sessionHistory.length){const nl=this.sessionHistory.map(x=>{let c='‚ö™';if(x.action.includes('ADDED')||x.action.includes('BLOCKED'))c='üî¥';else c='üü¢'; return `- ${c} [${x.date}] **${x.action}**: \`${x.val}\` | Reason: *${x.note || 'No reason'}*`;}).join('\n');ht=ht?ht+'\n'+nl:nl;} md+=`\n${h}\n${ht||'*No history yet.*'}\n`; return md; },
            async loadLog(t) { this.currentView=t+'-log'; this.activeLogContent=''; this.loadingLog=true; const octokit=new Octokit({auth:this.token}); try{const r=await octokit.request(`GET /repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${LOGS[t]}`); this.activeLogContent=decodeURIComponent(escape(atob(r.data.content)));}catch(e){if(e.status!==404)this.activeLogContent=`Error: ${e.message}`;}finally{this.loadingLog=false;} }
        }
    }).mount('#app');
</script>
</body>
</html>
